<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${titulo ?: 'Fresas con Crema'}">Fresas con Crema</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
        integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

<body>

    <nav class="navbar navbar-expand-lg navbar-dark bg-danger bg-gradient shadow-sm">
        <div class="container">
            <a class="navbar-brand" th:href="@{/}">
                üçì **TuMarca** de Fresas
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" th:href="@{/}">Inicio</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" th:href="@{/catalogo}">Cat√°logo / Pedir</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div th:replace="${contenido}">
    </div>


    <footer class="bg-dark text-white text-center p-4 mt-5">
        <div class="container">
            <p class="mb-0">&copy; 2025 Tu Negocio de Fresas. Todos los derechos reservados.</p>
        </div>
    </footer>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>

    <script>
        // Un "carrito" simple que persiste en la sesi√≥n del navegador
        let pedido = JSON.parse(sessionStorage.getItem('pedido')) || {};

        function agregarAlPedido(id, nombre, precio) {
            const idStr = String(id);
            if (pedido[idStr]) {
                pedido[idStr].cantidad++;
            } else {
                pedido[idStr] = { nombre: nombre, precio: parseFloat(precio), cantidad: 1 };
            }
            // Guardar en sessionStorage
            sessionStorage.setItem('pedido', JSON.stringify(pedido));

            // Damos feedback al usuario
            const boton = document.querySelector(`button[data-id='${idStr}']`);
            if (boton) {
                boton.innerHTML = `<i class="fas fa-check"></i> A√±adido!`;
                setTimeout(() => {
                    boton.innerHTML = 'A√±adir al pedido';
                }, 1000);
            }

            // Actualizamos el resumen si existe en la p√°gina actual
            if (document.getElementById('resumen-pedido')) {
                actualizarResumen();
            }
        }

        function actualizarResumen() {
            const resumenEl = document.getElementById('resumen-pedido');
            if (!resumenEl) return; // No hacer nada si el resumen no est√° en la p√°gina

            resumenEl.innerHTML = ''; // Limpiamos la lista
            let totalPedido = 0;

            if (Object.keys(pedido).length === 0) {
                resumenEl.innerHTML = '<li class="list-group-item">A√∫n no has a√±adido productos.</li>';
                document.getElementById('total-pedido').innerText = '0.00';
                return;
            }

            for (const id in pedido) {
                const item = pedido[id];
                const subtotal = item.precio * item.cantidad;
                totalPedido += subtotal;

                resumenEl.innerHTML += `<li class="list-group-item d-flex justify-content-between align-items-center">
                                            <div>
                                                ${item.nombre}
                                                <small class="d-block text-muted">S/ ${item.precio.toFixed(2)} c/u</small>
                                            </div>
                                            <span class="badge bg-primary rounded-pill">${item.cantidad}</span>
                                        </li>`;
            }

            // Actualizar el total
            document.getElementById('total-pedido').innerText = totalPedido.toFixed(2);
        }

        function enviarPedidoWhatsApp() {
            if (Object.keys(pedido).length === 0) {
                alert("Por favor, a√±ade al menos un producto a tu pedido.");
                return;
            }

            // 1. Obtenemos el n√∫mero de WhatsApp guardado
            const numero = document.getElementById('config').dataset.whatsappNumero;

            // 2. Construimos el mensaje
            let mensaje = "¬°Hola! üëã Me gustar√≠a hacer el siguiente pedido:\n\n";
            let totalPedido = 0;
            for (const id in pedido) {
                const item = pedido[id];
                mensaje += `*${item.cantidad}x* - ${item.nombre}\n`;
                totalPedido += item.precio * item.cantidad;
            }
            mensaje += `\n*Total estimado: S/ ${totalPedido.toFixed(2)}*`;
            mensaje += "\n\nQuedo atento(a) a la confirmaci√≥n. ¬°Gracias!";

            // 3. Codificamos el mensaje para la URL
            const mensajeCodificado = encodeURIComponent(mensaje);

            // 4. Creamos la URL de la API de WhatsApp
            const urlWhatsApp = `https://api.whatsapp.com/send?phone=${numero}&text=${mensajeCodificado}`;

            // 5. Abrimos WhatsApp en una nueva pesta√±a
            window.open(urlWhatsApp, '_blank');

            // 6. Limpiar el carrito despu√©s de enviar
            pedido = {};
            sessionStorage.removeItem('pedido');
            actualizarResumen();
        }
    </script>
</body>

</html>